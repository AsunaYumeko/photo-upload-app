#:kivy 2.0

<MainScreen>:
    name: 'main'
    BoxLayout:
        orientation: 'vertical'
        padding: 15
        spacing: 10
        
        # Header
        BoxLayout:
            size_hint_y: None
            height: 60
            spacing: 15
            
            Label:
                text: 'PDA Sign-off'
                font_size: '22sp'
                size_hint_x: 0.5
            
            Button:
                text: 'Settings'
                size_hint_x: 0.5
                font_size: '16sp'
                on_release: app.root.current = 'settings'
                background_color: 0.5, 0.5, 0.5, 1
        
        # Task List Header
        BoxLayout:
            size_hint_y: None
            height: 50
            spacing: 15
            
            Label:
                text: 'Tasks'
                font_size: '18sp'
                size_hint_x: 0.4
            
            Button:
                text: 'Refresh'
                size_hint_x: 0.6
                font_size: '16sp'
                on_release: root.refresh_tasks()
                background_color: 0.2, 0.6, 1, 1
        
        # Task List Container
        BoxLayout:
            size_hint_y: None
            height: 180
            canvas.before:
                Color:
                    rgba: 0.2, 0.2, 0.2, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: task_container
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5
                    padding: 5
        
        # Current Order Info
        BoxLayout:
            size_hint_y: None
            height: 45
            spacing: 20
            
            Label:
                id: order_label
                text: 'Order: None'
                font_size: '16sp'
                size_hint_x: 0.65
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                shorten: True
                shorten_from: 'right'
            
            Label:
                id: photo_count_label
                text: 'Photos: 0'
                font_size: '16sp'
                size_hint_x: 0.35
                halign: 'right'
                valign: 'middle'
                text_size: self.width, None
        
        # Photo Preview
        BoxLayout:
            size_hint_y: 0.35
            canvas.before:
                Color:
                    rgba: 0.9, 0.9, 0.9, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            Image:
                id: photo_preview
                source: ''
                allow_stretch: True
                keep_ratio: True
        
        # Status
        Label:
            id: status_label
            text: 'Select a task'
            font_size: '16sp'
            size_hint_y: None
            height: 35
            color: 0.5, 0.5, 0.5, 1
        
        # Loading
        ProgressBar:
            id: loading_bar
            size_hint_y: None
            height: 8
            max: 100
            value: 0
            opacity: 0
        
        # Action Buttons
        BoxLayout:
            size_hint_y: None
            height: 70
            spacing: 15
            
            Button:
                text: 'Capture'
                on_release: root.capture_photo()
                background_color: 0.2, 0.6, 1, 1
                font_size: '20sp'
            
            Button:
                text: 'Submit'
                on_release: root.submit_sign()
                background_color: 0.2, 0.8, 0.2, 1
                font_size: '20sp'


<SettingsScreen>:
    name: 'settings'
    BoxLayout:
        orientation: 'vertical'
        padding: 25
        spacing: 20
        
        Label:
            text: 'Settings'
            font_size: '26sp'
            size_hint_y: None
            height: 60
        
        Label:
            text: 'API URL:'
            font_size: '18sp'
            size_hint_y: None
            height: 35
            halign: 'left'
            text_size: self.size
        
        TextInput:
            id: api_url_input
            hint_text: 'http://192.168.100.100:8099'
            font_size: '16sp'
            multiline: False
            size_hint_y: None
            height: 55
        
        Label:
            id: validation_label
            text: ''
            font_size: '16sp'
            size_hint_y: None
            height: 35
            color: 1, 0, 0, 1
        
        Widget:
            size_hint_y: 0.2
        
        Button:
            text: 'Test Connection'
            font_size: '18sp'
            size_hint_y: None
            height: 60
            on_release: root.test_connection()
            background_color: 0.2, 0.6, 1, 1
        
        BoxLayout:
            size_hint_y: None
            height: 60
            spacing: 15
            
            Button:
                text: 'Save'
                font_size: '18sp'
                on_release: root.save_config()
                background_color: 0.2, 0.8, 0.2, 1
            
            Button:
                text: 'Back'
                font_size: '18sp'
                on_release: app.root.current = 'main'
                background_color: 0.5, 0.5, 0.5, 1
